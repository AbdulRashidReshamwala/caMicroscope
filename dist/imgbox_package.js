parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"WDG/":[function(require,module,exports) {
"use strict";function e(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}function t(){function t(e,t){return new Promise(function(o,r){Store.prototype.db.then(function(r){r.transaction(e).objectStore(e,"readonly").getAll().then(function(e){o(e.filter(function(e){var o=!0;for(var r in t)o=o&&Object.byString(e,r)==t[r];return o}))})})})}function o(e,t){var o=JSON.parse(window.localStorage.getItem(e));return o?o.filter(function(e){var o=!0;for(var r in t)o=o&&Object.byString(e,r)==t[r];return o}):[]}function r(e,t){var o=JSON.parse(window.localStorage.getItem(e));return o?o.filter(function(e){return e._id==t})[0]:{}}Store.prototype.db=idb.openDb("heatmap",1,function(e){e.createObjectStore("heatmap",{autoIncrement:!0})}),console.warn("{localstore mods enabled}"),Object.byString=function(e,t){for(var o=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),r=0,n=o.length;r<n;++r){var a=o[r];if(!(a in e))return;e=e[a]}return e},Store.prototype.validation=Store.prototype.validation||{},Store.prototype.filterBroken=Store.prototype.filterBroken||function(e,t){return e},Store.prototype.findMarkTypes=function(t,r){return new Promise(function(n,a){var i={};r&&(i["provenance.analysis.execution_id"]=r),t&&(i["provenance.image.slide"]=t);var l=o("mark",i);l?n([].concat(e(new Set(l.map(function(e){return Object.byString(e,"provenance.analysis")}))))):n([])})},Store.prototype.findMark=function(e,t,r,n,a,i,l,c){var d=this;return new Promise(function(r,a){var i={};t&&(i["provenance.image.slide"]=e),e&&(i["provenance.analysis.execution_id"]=t),n&&(i["provenance.analysis.source"]=n),r(o("mark",i))}).then(function(e){return d.filterBroken(e,"mark")})},Store.prototype.getMarkByIds=function(t,r,n,a,i,l,c,d){var f=this;return new Promise(function(n,a){var i=[];for(var l in t)i.push.apply(i,e(o("mark",{"provenance.analysis.execution_id":t[l],"provenance.image.slide":r})));n(i)}).then(function(e){return f.filterBroken(e,"mark")})},Store.prototype.getMark=function(e){var t=this;return new Promise(function(t,o){t(r("mark",e))}).then(function(e){return t.filterBroken(e,"mark")})},Store.prototype.addMark=function(e){return this.validation.mark(e)||console.warn(this.validation.mark.errors),new Promise(function(t,o){var r,n,a;e._id=e._id||{$oid:Date.now()},t((r="mark",n=e,(a=(a=JSON.parse(window.localStorage.getItem(r)))||[]).push(n),window.localStorage.setItem(r,JSON.stringify(a)),n))})},Store.prototype.deleteMark=function(e,t){return new Promise(function(t,o){t(function(e,t){console.log(t);var o=JSON.parse(window.localStorage.getItem(e)),r=(o=o||[]).filter(function(e){return e._id.$oid!==t});window.localStorage.setItem(e,JSON.stringify(r));var n=o.length-r.length;return{deletedCount:n,rowsAffected:n}}("mark",e))})},Store.prototype.findHeatmap=function(e,o){var r=this;return new Promise(function(e,r){var n={};o&&(n["provenance.analysis.execution_id"]=o),e(t("heatmap",n))}).then(function(e){return r.filterBroken(e,"heatmap")})},Store.prototype.findHeatmapType=function(e,o){var r=this;return new Promise(function(e,r){var n={};o&&(n["provenance.analysis.execution_id"]=o),e(t("heatmap",n))}).then(function(e){return r.filterBroken(e,"heatmap")})},Store.prototype.getHeatmap=function(e,o){var r=this;return new Promise(function(e,r){var n={};o&&(n["provenance.analysis.execution_id"]=o),e(t("heatmap",n))}).then(function(e){return r.filterBroken(e,"heatmap")})},Store.prototype.addHeatmap=function(e){return this.validation.heatmap(e)||console.warn(this.validation.heatmap.errors),e._id=e._id||{$oid:Date.now()},new Promise(function(t,o){var r,n;t((r="heatmap",n=e,Store.prototype.db.then(function(e){e.transaction(r,"readwrite").objectStore(r).add(n)}),n))})},Store.prototype.deleteHeatmap=function(e,t){return new Promise(function(t,o){t(function(e,t){return console.warn("Some issues with Deleting a Single Heatmap in LocalStore"),Store.prototype.db.then(function(o){o.transaction(e,"readwrite").objectStore(e).delete(t)}),""}("heatmap",e))})},Store.prototype.clearHeatmaps=function(){return new Promise(function(e,t){var o;e((o="heatmap",Store.prototype.db.then(function(e){e.transaction(o,"readwrite").objectStore(o).clear(o)}),""))})},Store.prototype.export=function(e){return new Promise(function(t,o){t(window.localStorage.getItem(e))})},Store.prototype.import=function(e,t){return new Promise(function(o,r){o(window.localStorage.setItem(e,t))})},Store.prototype.findSlide=function(e,t,o,r){return new Promise(function(e,t){var o=new URLSearchParams(document.location.search.substring(1)).get("slideId")||"local";e([{_id:{$oid:o},mpp:"0.001",location:o,name:o}])})},Store.prototype.getSlide=function(e){return new Promise(function(e,t){var o=new URLSearchParams(document.location.search.substring(1)),r=o.get("slideId")||"local";console.log(o),e({_id:{$oid:r},mpp:"0.001",location:r,name:r})})},Store.prototype.findTemplate=function(e,t){var r=this,n={};return e&&(n.name=e),t&&(n.type=t),new Promise(function(e,t){e(o("template",n))}).then(function(e){return r.filterBroken(e,"template")})},Store.prototype.getTemplate=function(e){var t=this;return new Promise(function(t,o){t(r("template",e))}).then(function(e){return t.filterBroken(e,"template")})},Store.prototype.DownloadMarksToFile=function(){var e=$D.params.id;e=decodeURIComponent(e);var t={};t["provenance.image.slide"]=e;var o=JSON.parse(window.localStorage.getItem("mark")),r="";o&&(r=JSON.stringify(o.filter(function(e){var o=!0;for(var r in t)o=o&&Object.byString(e,r)==t[r];return o})));var n=document.createElement("a"),a=new Blob([r],{type:"application/json"}),i=URL.createObjectURL(a);n.setAttribute("href",i),n.setAttribute("download","markups.json"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},Store.prototype.LoadMarksFromFile=function(){var e=$D.params.id;e=decodeURIComponent(e);var t=document.createElement("input");document.body.appendChild(t),t.setAttribute("type","file"),t.style.display="position: fixed; top: -100em",t.onchange=function(t){var o=t.target,r=new FileReader;r.onload=function(){var t=r.result;try{var o=JSON.parse(t);console.log(o),o.forEach(function(t){t.provenance.image.slide=e}),console.log($VALIDATION.mark);var n=JSON.parse(window.localStorage.getItem("mark"));n=n||[],console.log(n),n=(n=n.concat(o)).filter($VALIDATION.mark),console.log(n),window.localStorage.setItem("mark",JSON.stringify(n)),$VALIDATION.mark.errors?console.error($VALIDATION.mark.errors):window.location.reload()}catch(e){console.error(e)}console.log(t.substring(0,200))},r.readAsText(o.files[0])},t.click(),document.body.removeChild(t)}}Object.defineProperty(exports,"__esModule",{value:!0}),Store.prototype.updateHeatmapFields=function(e,t,o,r){var n={};return t&&(n["provenance.analysis.execution_id"]=t),console.log(r,o),new Promise(function(e,t){findInIDB("heatmap",n).then(function(t){var o=t[0];removeFromIDB("heatmap",o._id).then(function(t){o.data=data,e(putInIDB("heatmap",o))})})})},Store.prototype.addHeatmapEdit=function(e){return e._id=e._id||{$oid:Date.now()},new Promise(function(t,o){t(putInIDB("heatmapEdit",e))})},Store.prototype.addLog=function(e){console.info("[LOG]",e)},Store.prototype.updateHeatmapEdit=function(e,t,o,r){var n={};return o&&(n["provenance.analysis.execution_id"]=o),new Promise(function(e,t){findInIDB("heatmapEdit",n).then(function(t){var o=t[0];removeFromIDB("heatmapEdit",o.id).then(function(t){o.data=r,e(putInIDB("heatmapEdit",o))})})})},Store.prototype.deleteHeatmapEdit=function(e,t,o){var r={};return r.user=e,o&&(r["provenance.analysis.execution_id"]=o),new Promise(function(e,t){findInIDB("heatmapEdit",r).then(function(t){e(removeFromIDB("heatmapEdit",t[0]._id))})})};var o={_id:"0",type:"object",id:"annotation-form",name:"AnnotSchema",description:"",links:[],additionalProperties:!1,properties:{name:{id:"a0",title:"Identity Name",type:"string",required:!0,description:"note name"},notes:{id:"a1",title:"Notes: ",type:"string",format:"textarea",maxLength:128}}},r=[{title:"Lymph",value:"Lymph",children:[{title:"Positive",value:"Positive",children:[{title:100,value:100,color:"#ff6296",checked:!0,data:{color:"#ff6296",mode:"grid",type:"Lymph-Positive",size:100}},{title:"Point",value:"Point",color:"#ff6296",data:{color:"#ff6296",mode:"point",type:"Lymph-Positive"}}]},{title:"Negative",value:"Negative",children:[{title:100,value:100,color:"#62ffcb",data:{color:"#62ffcb",mode:"grid",type:"Lymph-Negative",size:100}},{title:"Point",value:"Point",color:"#62ffcb",data:{color:"#62ffcb",mode:"point",type:"Lymph-Negative"}}]}]},{title:"Neutrophil",value:"Neutrophil",children:[{title:"Positive",value:"Positive",color:"#ffcb62",data:{color:"#ffcb62",mode:"grid",type:"Neutrophil-Positive",size:50}},{title:"Negative",value:"Negative",color:"#6296ff",data:{color:"#6296ff",mode:"grid",type:"Neutrophil-Negative",size:50}}]},{title:"Necrosis",value:"Necrosis",children:[{title:"Positive",value:"Positive",children:[{title:100,value:100,color:"#ff00d9",data:{color:"#ff00d9",mode:"grid",type:"Necrosis-Positive",size:100}},{title:500,value:500,color:"#ff00d9",data:{color:"#ff00d9",mode:"grid",type:"Necrosis-Positive",size:500}}]},{title:"Negative",value:"Negative",children:[{title:100,value:100,color:"#00ff26",data:{color:"#00ff26",mode:"grid",type:"Necrosis-Negative",size:100}},{title:500,value:500,color:"#00ff26",data:{color:"#00ff26",mode:"grid",type:"Necrosis-Negative",size:500}}]}]},{title:"Tumor",value:"Tumor",children:[{title:"Positive",value:"Positive",children:[{title:100,value:100,color:"#790cff",data:{color:"#790cff",mode:"grid",type:"Tumor-Positive",size:100}},{title:300,value:300,color:"#790cff",data:{color:"#790cff",mode:"grid",type:"Tumor-Positive",size:300}},{title:1e3,value:1e3,color:"#790cff",data:{color:"#790cff",mode:"grid",type:"Tumor-Positive",size:1e3}},{title:2e3,value:2e3,color:"#790cff",data:{color:"#790cff",mode:"grid",type:"Tumor-Positive",size:2e3}}]},{title:"Negative",value:"Negative",children:[{title:100,value:100,color:"#92ff0c",data:{color:"#92ff0c",mode:"grid",type:"Tumor-Negative",size:100}},{title:300,value:300,color:"#92ff0c",data:{color:"#92ff0c",mode:"grid",type:"Tumor-Negative",size:300}},{title:1e3,value:1e3,color:"#92ff0c",data:{color:"#92ff0c",mode:"grid",type:"Tumor-Negative",size:1e3}},{title:2e3,value:2e3,color:"#92ff0c",data:{color:"#92ff0c",mode:"grid",type:"Tumor-Negative",size:2e3}}]}]},{title:"Prostate",value:"Prostate",children:[{title:"Benign",value:"Benign",color:"#8dd3c7",checked:!0,data:{color:"#8dd3c7",mode:"free",type:"Prostate-Benign"}},{title:"Gleason 3",value:"Gleason 3",color:"#ffffb3",data:{color:"#ffffb3",mode:"free",type:"Prostate-Gleason 3"}},{title:"Gleason 4",value:"Gleason 4",color:"#bebada",data:{color:"#bebada",mode:"free",type:"Prostate-Gleason 4"}},{title:"Gleason 5",value:"Gleason 5",color:"#fb8072",data:{color:"#fb8072",mode:"free",type:"Prostate-Gleason 5"}},{title:"Cancer NOS",value:"Cancer NOS",color:"#80b1d3",data:{color:"#80b1d3",mode:"free",type:"Prostate-Cancer NOS"}}]},{title:"NSCLC",value:"NSCLC",children:[{title:"Benign",value:"Benign",color:"#fdb462",data:{color:"#fdb462",mode:"free",type:"NSCLC-Benign"}},{title:"Squamous CA",value:"Squamous CA",color:"#b3de69",data:{color:"#b3de69",mode:"free",type:"NSCLC-Squamous CA"}},{title:"Adeno CA (all)",value:"Adeno CA (all)",color:"#fccde5",data:{color:"#fccde5",mode:"free",type:"NSCLC-Adeno CA (all)"}},{title:"Acinar",value:"Acinar",color:"#d9d9d9",data:{color:"#d9d9d9",mode:"free",type:"NSCLC-Acinar"}},{title:"Lapidic",value:"Lapidic",color:"#bc80bd",data:{color:"#bc80bd",mode:"free",type:"NSCLC-Lapidic"}},{title:"Solid",value:"Solid",color:"#ccebc5",data:{color:"#ccebc5",mode:"free",type:"NSCLC-Solid"}},{title:"Papillary",value:"Papillary",color:"#ffed6f",data:{color:"#ffed6f",mode:"free",type:"NSCLC-Papillary"}},{title:"Micropapillary",value:"Micropapillary",color:"#6a3d9a",data:{color:"#6a3d9a",mode:"free",type:"NSCLC-Micropapillary"}}]}],n=JSON.parse(window.localStorage.getItem("penConfig"));n||((n=[]).push({config_name:"preset_label",configuration:r}),window.localStorage.setItem("penConfig",JSON.stringify(n))),Store.prototype.getConfigByName=function(e){return"preset_label"==e?new Promise(function(e,t){e(n)}):new Promise(function(e,t){e([])})};var a=JSON.parse(window.localStorage.getItem("template"));a||((a=[]).push(o),window.localStorage.setItem("template",JSON.stringify(a))),exports.default=t;
},{}],"5g62":[function(require,module,exports) {
"use strict";function e(){console.warn("{imgbox mods enabled}"),CaMic.prototype.default_loadImg=CaMic.prototype.loadImg,CaMic.prototype.loadImg=function(e){var p=this,t=new URLSearchParams(window.location.search).get("id"),i=t;this.slideId=i,this.slideName=i,fetch(t+"/info.json").then(function(e){if(e.status>=400)throw e;return e.json()}).then(function(i){for(var o=Math.ceil(Math.log2(Math.max(i.height,i.width))),a=[],n=0;n<=o;n++)a.push(Math.pow(2,n));var m={"@context":"http://iiif.io/api/image/2/context.json","@id":t,height:i.height,width:i.width,profile:["http://iiif.io/api/image/2/level2.json"],protocol:"http://iiif.io/api/image",tiles:[{scaleFactors:a,width:256}]};p.viewer.open(m),p.mpp_x=i["mpp-x"],p.mpp_y=i["mpp-y"],p.mpp=i.mpp||p.mpp_x||p.mpp_y||1e9,p.mpp_x=i["mpp-x"]||p.mpp,p.mpp_y=i["mpp-y"]||p.mpp,p.viewer.mpp=p.mpp,p.viewer.mpp_x=p.mpp_x,p.viewer.mpp_y=p.mpp_y;var r=p.mpp_x||p.mpp;r&&1e9!=r&&p.createScalebar(p.mpp),new OpenSeadragonImaging.ImagingHelper({viewer:p.viewer}).setMaxZoom(1);var l={_id:"0"};l.name=p.slideName,l.mpp=p.mpp,l.mpp_x=p.mpp_x,l.mpp_y=p.mpp_y,l.location=t,l.url=m,e&&"function"==typeof e&&e.call(null,l),Loading.text.textContent="Loading Slide's Tiles..."}).catch(function(e){console.error(e),Loading.text.textContent="ERROR - Slide May be Broken or Unsupported"})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"lM4v":[function(require,module,exports) {
"use strict";var e=require("./LocalStore.js"),r=t(e),o=require("./ImgBoxMods.js"),s=t(o);function t(e){return e&&e.__esModule?e:{default:e}}(0,r.default)(),(0,s.default)(),console.warn("This setup is intended for imagebox");
},{"./LocalStore.js":"WDG/","./ImgBoxMods.js":"5g62"}]},{},["lM4v"], null)
//# sourceMappingURL=./imgbox_package.map
